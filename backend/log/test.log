  [1m[35m (219.2ms)[0m  [1m[35mCREATE DATABASE "ringle_task_test" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.2ms)[0m  [1m[35mSET search_path TO public[0m
  [1m[35m (68.2ms)[0m  [1m[35mCREATE DATABASE "ringle_task_test" ENCODING = 'unicode'[0m
  [1m[35mSQL (0.9ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql" SCHEMA pg_catalog[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "conversations" CASCADE[0m
  [1m[35m (36.9ms)[0m  [1m[35mCREATE TABLE "conversations" ("id" bigserial primary key, "user_id" bigint NOT NULL, "title" character varying NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (4.7ms)[0m  [1m[35mCREATE INDEX "index_conversations_on_created_at" ON "conversations" ("created_at")[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE INDEX "index_conversations_on_user_id" ON "conversations" ("user_id")[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "memberships" CASCADE[0m
  [1m[35m (6.9ms)[0m  [1m[35mCREATE TABLE "memberships" ("id" bigserial primary key, "user_id" bigint NOT NULL, "membership_type" character varying NOT NULL, "start_date" date NOT NULL, "end_date" date NOT NULL, "price" decimal(10,2), "status" character varying DEFAULT 'active', "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE INDEX "index_memberships_on_end_date" ON "memberships" ("end_date")[0m
  [1m[35m (2.8ms)[0m  [1m[35mCREATE INDEX "index_memberships_on_membership_type" ON "memberships" ("membership_type")[0m
  [1m[35m (2.3ms)[0m  [1m[35mCREATE INDEX "index_memberships_on_start_date" ON "memberships" ("start_date")[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE INDEX "index_memberships_on_status" ON "memberships" ("status")[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE INDEX "index_memberships_on_user_id" ON "memberships" ("user_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "messages" CASCADE[0m
  [1m[35m (5.4ms)[0m  [1m[35mCREATE TABLE "messages" ("id" bigserial primary key, "conversation_id" bigint NOT NULL, "role" character varying NOT NULL, "content" text NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (2.4ms)[0m  [1m[35mCREATE INDEX "index_messages_on_conversation_id_and_created_at" ON "messages" ("conversation_id", "created_at")[0m
  [1m[35m (2.7ms)[0m  [1m[35mCREATE INDEX "index_messages_on_conversation_id" ON "messages" ("conversation_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users" CASCADE[0m
  [1m[35m (5.1ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "email" character varying NOT NULL, "name" character varying NOT NULL, "phone" character varying, "birth_date" date, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.6ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (2.5ms)[0m  [1m[35mALTER TABLE "conversations" ADD CONSTRAINT "fk_rails_7c15d62a0a"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
[0m
  [1m[35m (2.4ms)[0m  [1m[35mALTER TABLE "memberships" ADD CONSTRAINT "fk_rails_99326fb65d"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
[0m
  [1m[35m (1.8ms)[0m  [1m[35mALTER TABLE "messages" ADD CONSTRAINT "fk_rails_7f927086d2"
FOREIGN KEY ("conversation_id")
  REFERENCES "conversations" ("id")
[0m
  [1m[35m (4.5ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (3)[0m
  [1m[35m (1.4ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(2),
(1);[0m
  [1m[35m (4.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.5ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-09-09 13:40:13.644677', '2025-09-09 13:40:13.644679') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.8ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', 'afce4bbc11c709de1d2e797f9591854cb5fee08f', '2025-09-09 13:40:13.647735', '2025-09-09 13:40:13.647736') RETURNING "key"[0m
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_try_advisory_lock(6544511797956908055)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT pg_advisory_unlock(6544511797956908055)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (3.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
Api::UsersControllerTest: test_should_show_user
-----------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (2.0ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (1.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Miss Nova Vandervort"], ["phone", "010-8389-9374"], ["birth_date", "2005-07-29"], ["created_at", "2025-09-09 13:40:23.572041"], ["updated_at", "2025-09-09 13:40:23.572041"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/users/1" for 127.0.0.1 at 2025-09-09 22:40:23 +0900
Processing by Api::UsersController#show as HTML
  Parameters: {"id" => "1"}
  [1m[36mUser Load (2.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 1], ["LIMIT", 1]]
Completed 200 OK in 24ms (Views: 0.3ms | ActiveRecord: 3.5ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
Api::UsersControllerTest: test_should_update_user
-------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (1.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Sonny Legros"], ["phone", "010-9626-1095"], ["birth_date", "1976-10-26"], ["created_at", "2025-09-09 13:40:23.655900"], ["updated_at", "2025-09-09 13:40:23.655900"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PATCH "/api/users/2" for 127.0.0.1 at 2025-09-09 22:40:23 +0900
Processing by Api::UsersController#update as HTML
  Parameters: {"user" => {"name" => "Updated Name"}, "id" => "2"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (1.6ms)[0m  [1m[33mUPDATE "users" SET "name" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["name", "Updated Name"], ["updated_at", "2025-09-09 13:40:23.668087"], ["id", 2]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 10ms (Views: 0.1ms | ActiveRecord: 9.3ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::UsersControllerTest: test_should_not_create_user_with_invalid_params
-------------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Dr. Janel Marvin"], ["phone", "010-3928-7660"], ["birth_date", "1998-01-25"], ["created_at", "2025-09-09 13:40:23.675110"], ["updated_at", "2025-09-09 13:40:23.675110"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Started POST "/api/users" for 127.0.0.1 at 2025-09-09 22:40:23 +0900
Processing by Api::UsersController#create as HTML
  Parameters: {"user" => {"name" => "", "email" => "[FILTERED]"}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 2ms (Views: 0.1ms | ActiveRecord: 1.2ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
Api::UsersControllerTest: test_should_create_user_with_valid_params
-------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Rupert Stoltenberg"], ["phone", "010-3255-8553"], ["birth_date", "2000-03-27"], ["created_at", "2025-09-09 13:40:23.685007"], ["updated_at", "2025-09-09 13:40:23.685007"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Started POST "/api/users" for 127.0.0.1 at 2025-09-09 22:40:23 +0900
Processing by Api::UsersController#create as HTML
  Parameters: {"user" => {"name" => "Test User", "email" => "[FILTERED]", "phone" => "010-1234-5678", "birth_date" => "1990-01-01"}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Test User"], ["phone", "010-1234-5678"], ["birth_date", "1990-01-01"], ["created_at", "2025-09-09 13:40:23.688096"], ["updated_at", "2025-09-09 13:40:23.688096"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 2ms (Views: 0.1ms | ActiveRecord: 1.6ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
Api::UsersControllerTest: test_should_destroy_user
--------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Kimbra Kiehn"], ["phone", "010-7265-2001"], ["birth_date", "1979-06-09"], ["created_at", "2025-09-09 13:40:23.693689"], ["updated_at", "2025-09-09 13:40:23.693689"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Started DELETE "/api/users/6" for 127.0.0.1 at 2025-09-09 22:40:23 +0900
Processing by Api::UsersController#destroy as HTML
  Parameters: {"id" => "6"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Load (1.5ms)[0m  [1m[34mSELECT "memberships".* FROM "memberships" WHERE "memberships"."user_id" = $1[0m  [["user_id", 6]]
  [1m[36mConversation Load (1.3ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."user_id" = $1[0m  [["user_id", 6]]
  [1m[36mUser Destroy (1.0ms)[0m  [1m[31mDELETE FROM "users" WHERE "users"."id" = $1[0m  [["id", 6]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 33ms (ActiveRecord: 13.3ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
Api::UsersControllerTest: test_should_get_index
-----------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Brice Hirthe"], ["phone", "010-7684-5931"], ["birth_date", "1984-11-10"], ["created_at", "2025-09-09 13:40:23.733984"], ["updated_at", "2025-09-09 13:40:23.733984"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/users" for 127.0.0.1 at 2025-09-09 22:40:23 +0900
Processing by Api::UsersController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.6ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
Api::UsersControllerTest: test_should_return_404_for_non-existent_user
----------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Ira Bailey"], ["phone", "010-5794-4879"], ["birth_date", "2005-04-15"], ["created_at", "2025-09-09 13:40:23.739848"], ["updated_at", "2025-09-09 13:40:23.739848"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/users/999999" for 127.0.0.1 at 2025-09-09 22:40:23 +0900
Processing by Api::UsersController#show as HTML
  Parameters: {"id" => "999999"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 999999], ["LIMIT", 1]]
Filter chain halted as :set_user rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.3ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (4.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (2.0ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
ChatControllerTest: test_should_stream_response_with_SSE_format
---------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (1.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (3.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (1.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Dirk Blick Ret."], ["phone", "010-3737-4634"], ["birth_date", "2000-07-12"], ["created_at", "2025-09-09 13:40:57.825429"], ["updated_at", "2025-09-09 13:40:57.825429"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (2.7ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 9], ["title", "Molestiae dolor quasi."], ["created_at", "2025-09-09 13:40:57.840730"], ["updated_at", "2025-09-09 13:40:57.840730"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ChatControllerTest: test_should_send_message_to_conversation
------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Jonathan Zulauf"], ["phone", "010-6238-9649"], ["birth_date", "1982-05-19"], ["created_at", "2025-09-09 13:40:57.896480"], ["updated_at", "2025-09-09 13:40:57.896480"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.5ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 10], ["title", "Repudiandae labore rem."], ["created_at", "2025-09-09 13:40:57.898148"], ["updated_at", "2025-09-09 13:40:57.898148"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
ChatControllerTest: test_should_handle_empty_message
----------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (1.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Stevie Shanahan"], ["phone", "010-7792-5408"], ["birth_date", "1986-08-10"], ["created_at", "2025-09-09 13:40:57.906195"], ["updated_at", "2025-09-09 13:40:57.906195"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.3ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 11], ["title", "Veniam nam esse."], ["created_at", "2025-09-09 13:40:57.908748"], ["updated_at", "2025-09-09 13:40:57.908748"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
ChatControllerTest: test_should_handle_invalid_conversation_id
--------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Jaime Prosacco"], ["phone", "010-6420-9667"], ["birth_date", "2002-04-03"], ["created_at", "2025-09-09 13:40:57.914473"], ["updated_at", "2025-09-09 13:40:57.914473"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.0ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 12], ["title", "Quibusdam enim beatae."], ["created_at", "2025-09-09 13:40:57.915861"], ["updated_at", "2025-09-09 13:40:57.915861"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
ChatControllerTest: test_should_create_conversation
---------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "John Marks"], ["phone", "010-3753-2564"], ["birth_date", "1977-02-28"], ["created_at", "2025-09-09 13:40:57.921401"], ["updated_at", "2025-09-09 13:40:57.921401"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.0ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 13], ["title", "Facilis adipisci cum."], ["created_at", "2025-09-09 13:40:57.922787"], ["updated_at", "2025-09-09 13:40:57.922787"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::UsersControllerTest: test_should_not_create_user_with_invalid_params
-------------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Isreal Labadie"], ["phone", "010-4634-3241"], ["birth_date", "1978-07-16"], ["created_at", "2025-09-09 13:40:57.928350"], ["updated_at", "2025-09-09 13:40:57.928350"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Started POST "/api/users" for 127.0.0.1 at 2025-09-09 22:40:57 +0900
Processing by Api::UsersController#create as HTML
  Parameters: {"user" => {"name" => "", "email" => "[FILTERED]"}}
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 10ms (Views: 0.2ms | ActiveRecord: 2.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
Api::UsersControllerTest: test_should_update_user
-------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Jonathan Zulauf"], ["phone", "010-5216-3790"], ["birth_date", "2003-05-16"], ["created_at", "2025-09-09 13:40:57.956642"], ["updated_at", "2025-09-09 13:40:57.956642"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PATCH "/api/users/15" for 127.0.0.1 at 2025-09-09 22:40:57 +0900
Processing by Api::UsersController#update as HTML
  Parameters: {"user" => {"name" => "Updated Name"}, "id" => "15"}
  [1m[36mUser Load (1.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 15], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.6ms)[0m  [1m[33mUPDATE "users" SET "name" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["name", "Updated Name"], ["updated_at", "2025-09-09 13:40:57.965909"], ["id", 15]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 9ms (Views: 0.1ms | ActiveRecord: 7.9ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 15], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
Api::UsersControllerTest: test_should_get_index
-----------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Tatum Shields DDS"], ["phone", "010-8395-4863"], ["birth_date", "1984-10-14"], ["created_at", "2025-09-09 13:40:57.972016"], ["updated_at", "2025-09-09 13:40:57.972016"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/users" for 127.0.0.1 at 2025-09-09 22:40:57 +0900
Processing by Api::UsersController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.6ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
Api::UsersControllerTest: test_should_return_404_for_non-existent_user
----------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Rupert Fisher"], ["phone", "010-8192-2372"], ["birth_date", "1992-08-08"], ["created_at", "2025-09-09 13:40:57.977930"], ["updated_at", "2025-09-09 13:40:57.977930"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/users/999999" for 127.0.0.1 at 2025-09-09 22:40:57 +0900
Processing by Api::UsersController#show as HTML
  Parameters: {"id" => "999999"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 999999], ["LIMIT", 1]]
Filter chain halted as :set_user rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
Api::UsersControllerTest: test_should_show_user
-----------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Desmond Bechtelar"], ["phone", "010-1621-9549"], ["birth_date", "1995-07-10"], ["created_at", "2025-09-09 13:40:57.983137"], ["updated_at", "2025-09-09 13:40:57.983137"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/users/18" for 127.0.0.1 at 2025-09-09 22:40:57 +0900
Processing by Api::UsersController#show as HTML
  Parameters: {"id" => "18"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 18], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
Api::UsersControllerTest: test_should_destroy_user
--------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Ina Ryan"], ["phone", "010-1871-2068"], ["birth_date", "1985-04-29"], ["created_at", "2025-09-09 13:40:57.988645"], ["updated_at", "2025-09-09 13:40:57.988645"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Started DELETE "/api/users/19" for 127.0.0.1 at 2025-09-09 22:40:57 +0900
Processing by Api::UsersController#destroy as HTML
  Parameters: {"id" => "19"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 19], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Load (1.2ms)[0m  [1m[34mSELECT "memberships".* FROM "memberships" WHERE "memberships"."user_id" = $1[0m  [["user_id", 19]]
  [1m[36mConversation Load (0.7ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."user_id" = $1[0m  [["user_id", 19]]
  [1m[36mUser Destroy (0.8ms)[0m  [1m[31mDELETE FROM "users" WHERE "users"."id" = $1[0m  [["id", 19]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 14ms (ActiveRecord: 8.0ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
Api::UsersControllerTest: test_should_create_user_with_valid_params
-------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Bryant Robel"], ["phone", "010-9879-3519"], ["birth_date", "1986-10-15"], ["created_at", "2025-09-09 13:40:58.009093"], ["updated_at", "2025-09-09 13:40:58.009093"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Started POST "/api/users" for 127.0.0.1 at 2025-09-09 22:40:58 +0900
Processing by Api::UsersController#create as HTML
  Parameters: {"user" => {"name" => "Test User", "email" => "[FILTERED]", "phone" => "010-1234-5678", "birth_date" => "1990-01-01"}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Test User"], ["phone", "010-1234-5678"], ["birth_date", "1990-01-01"], ["created_at", "2025-09-09 13:40:58.012614"], ["updated_at", "2025-09-09 13:40:58.012614"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 2ms (Views: 0.1ms | ActiveRecord: 1.7ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
ChatControllerTest: test_should_handle_invalid_conversation_id
--------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.9ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (2.1ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (1.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Prof. Perry Goldner"], ["phone", "010-9463-1364"], ["birth_date", "1995-06-30"], ["created_at", "2025-09-09 13:42:47.847239"], ["updated_at", "2025-09-09 13:42:47.847239"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (2.2ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 22], ["title", "Nesciunt occaecati aut."], ["created_at", "2025-09-09 13:42:47.861698"], ["updated_at", "2025-09-09 13:42:47.861698"]]
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/chat/message" for 127.0.0.1 at 2025-09-09 22:42:47 +0900
Processing by ChatController#message as HTML
  Parameters: {"conversation_id" => "999999", "message" => "Test message", "user_id" => "22"}
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (3.3ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 999999], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
SSE Error: Validation failed: Conversation must exist
Completed 200 OK in 26ms (ActiveRecord: 9.8ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
ChatControllerTest: test_should_handle_empty_message
----------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Eli Doyle"], ["phone", "010-5525-9333"], ["birth_date", "1996-01-25"], ["created_at", "2025-09-09 13:42:47.945507"], ["updated_at", "2025-09-09 13:42:47.945507"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.9ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 23], ["title", "Ratione eos ut."], ["created_at", "2025-09-09 13:42:47.947323"], ["updated_at", "2025-09-09 13:42:47.947323"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/chat/message" for 127.0.0.1 at 2025-09-09 22:42:47 +0900
Processing by ChatController#message as HTML
  Parameters: {"conversation_id" => "7", "message" => "", "user_id" => "23"}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 7], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
SSE Error: Validation failed: Content can't be blank
Completed 200 OK in 3ms (ActiveRecord: 1.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
ChatControllerTest: test_should_return_error_without_user
---------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Alex Daniel IV"], ["phone", "010-6215-2589"], ["birth_date", "1983-05-02"], ["created_at", "2025-09-09 13:42:47.956560"], ["updated_at", "2025-09-09 13:42:47.956560"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.8ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 24], ["title", "Beatae et sed."], ["created_at", "2025-09-09 13:42:47.958150"], ["updated_at", "2025-09-09 13:42:47.958150"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/chat" for 127.0.0.1 at 2025-09-09 22:42:47 +0900
Processing by ChatController#create as HTML
  Parameters: {"title" => "New Chat"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
Completed 422 Unprocessable Content in 3ms (Views: 0.2ms | ActiveRecord: 0.7ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
ChatControllerTest: test_should_stream_response_with_SSE_format
---------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Trenton Gislason"], ["phone", "010-5658-4211"], ["birth_date", "1993-06-02"], ["created_at", "2025-09-09 13:42:47.967351"], ["updated_at", "2025-09-09 13:42:47.967351"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.1ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 25], ["title", "Enim in maxime."], ["created_at", "2025-09-09 13:42:47.969021"], ["updated_at", "2025-09-09 13:42:47.969021"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ChatControllerTest: test_should_send_message_to_conversation
------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Dr. Lorette Russel"], ["phone", "010-1660-1258"], ["birth_date", "1981-03-17"], ["created_at", "2025-09-09 13:42:47.974217"], ["updated_at", "2025-09-09 13:42:47.974217"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.9ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 26], ["title", "Minus sunt praesentium."], ["created_at", "2025-09-09 13:42:47.975745"], ["updated_at", "2025-09-09 13:42:47.975745"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
ChatControllerTest: test_should_create_conversation
---------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Gov. Kyle Little"], ["phone", "010-3088-7970"], ["birth_date", "1999-10-11"], ["created_at", "2025-09-09 13:42:47.980601"], ["updated_at", "2025-09-09 13:42:47.980601"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.8ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 27], ["title", "Possimus debitis quae."], ["created_at", "2025-09-09 13:42:47.981901"], ["updated_at", "2025-09-09 13:42:47.981901"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "conversations"[0m
Started POST "/chat" for 127.0.0.1 at 2025-09-09 22:42:47 +0900
Processing by ChatController#create as HTML
  Parameters: {"title" => "New Chat", "user_id" => "27"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 27], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.1ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 27], ["title", "New Chat"], ["created_at", "2025-09-09 13:42:47.988032"], ["updated_at", "2025-09-09 13:42:47.988032"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (Views: 0.2ms | ActiveRecord: 2.4ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "conversations"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.9ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.6ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
ChatControllerTest: test_should_return_error_without_user
---------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (2.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (1.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Miss Torie Maggio"], ["phone", "010-9743-3764"], ["birth_date", "2003-10-15"], ["created_at", "2025-09-09 13:43:22.486130"], ["updated_at", "2025-09-09 13:43:22.486130"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (2.1ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 28], ["title", "Est laborum maxime."], ["created_at", "2025-09-09 13:43:22.501064"], ["updated_at", "2025-09-09 13:43:22.501064"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/chat" for 127.0.0.1 at 2025-09-09 22:43:22 +0900
Processing by ChatController#create as HTML
  Parameters: {"title" => "New Chat"}
  [1m[36mUser Load (2.6ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
Completed 422 Unprocessable Content in 13ms (Views: 0.2ms | ActiveRecord: 3.6ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ChatControllerTest: test_should_send_message_to_conversation
------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (3.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Jammie McLaughlin"], ["phone", "010-7023-6567"], ["birth_date", "1983-02-11"], ["created_at", "2025-09-09 13:43:22.572855"], ["updated_at", "2025-09-09 13:43:22.572855"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.9ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 29], ["title", "Sapiente itaque cumque."], ["created_at", "2025-09-09 13:43:22.574668"], ["updated_at", "2025-09-09 13:43:22.574668"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
ChatControllerTest: test_should_stream_response_with_SSE_format
---------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Shamika Bergstrom Ret."], ["phone", "010-3729-3574"], ["birth_date", "1982-04-23"], ["created_at", "2025-09-09 13:43:22.579739"], ["updated_at", "2025-09-09 13:43:22.579739"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.0ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 30], ["title", "Ducimus earum quo."], ["created_at", "2025-09-09 13:43:22.581616"], ["updated_at", "2025-09-09 13:43:22.581616"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
ChatControllerTest: test_should_create_conversation
---------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Demarcus Pagac"], ["phone", "010-7910-1422"], ["birth_date", "1989-11-03"], ["created_at", "2025-09-09 13:43:22.587267"], ["updated_at", "2025-09-09 13:43:22.587267"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.0ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 31], ["title", "Qui perspiciatis sed."], ["created_at", "2025-09-09 13:43:22.588778"], ["updated_at", "2025-09-09 13:43:22.588778"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "conversations"[0m
Started POST "/chat" for 127.0.0.1 at 2025-09-09 22:43:22 +0900
Processing by ChatController#create as HTML
  Parameters: {"title" => "New Chat", "user_id" => "31"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 31], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.2ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 31], ["title", "New Chat"], ["created_at", "2025-09-09 13:43:22.597274"], ["updated_at", "2025-09-09 13:43:22.597274"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 2.8ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "conversations"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
ChatControllerTest: test_should_handle_empty_message
----------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Margarito Bernhard"], ["phone", "010-4089-6867"], ["birth_date", "1993-07-12"], ["created_at", "2025-09-09 13:43:22.604711"], ["updated_at", "2025-09-09 13:43:22.604711"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.3ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 32], ["title", "Iure ducimus eaque."], ["created_at", "2025-09-09 13:43:22.606317"], ["updated_at", "2025-09-09 13:43:22.606317"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/chat/message" for 127.0.0.1 at 2025-09-09 22:43:22 +0900
Processing by ChatController#message as HTML
  Parameters: {"conversation_id" => "18", "message" => "", "user_id" => "32"}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (1.3ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 18], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
SSE Error: Validation failed: Content can't be blank
Completed 200 OK in 12ms (ActiveRecord: 7.2ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
ChatControllerTest: test_should_handle_invalid_conversation_id
--------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Robbie Casper"], ["phone", "010-3020-8730"], ["birth_date", "1994-08-18"], ["created_at", "2025-09-09 13:43:22.624778"], ["updated_at", "2025-09-09 13:43:22.624778"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.9ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 33], ["title", "Beatae minus et."], ["created_at", "2025-09-09 13:43:22.626327"], ["updated_at", "2025-09-09 13:43:22.626327"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/chat/message" for 127.0.0.1 at 2025-09-09 22:43:22 +0900
Processing by ChatController#message as HTML
  Parameters: {"conversation_id" => "999999", "message" => "Test message", "user_id" => "33"}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 999999], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
SSE Error: Validation failed: Conversation must exist
Completed 200 OK in 2ms (ActiveRecord: 1.3ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
Api::UsersControllerTest: test_should_return_404_for_non-existent_user
----------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Miss Torie Maggio"], ["phone", "010-1765-6233"], ["birth_date", "1999-11-08"], ["created_at", "2025-09-09 13:43:22.634188"], ["updated_at", "2025-09-09 13:43:22.634188"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/users/999999" for 127.0.0.1 at 2025-09-09 22:43:22 +0900
Processing by Api::UsersController#show as HTML
  Parameters: {"id" => "999999"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 999999], ["LIMIT", 1]]
Filter chain halted as :set_user rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
Api::UsersControllerTest: test_should_show_user
-----------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Gordon Hane"], ["phone", "010-4179-5229"], ["birth_date", "1975-11-15"], ["created_at", "2025-09-09 13:43:22.642068"], ["updated_at", "2025-09-09 13:43:22.642068"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/users/35" for 127.0.0.1 at 2025-09-09 22:43:22 +0900
Processing by Api::UsersController#show as HTML
  Parameters: {"id" => "35"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 35], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
Api::UsersControllerTest: test_should_update_user
-------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Amiee Bayer"], ["phone", "010-5384-7463"], ["birth_date", "2002-07-03"], ["created_at", "2025-09-09 13:43:22.647723"], ["updated_at", "2025-09-09 13:43:22.647723"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PATCH "/api/users/36" for 127.0.0.1 at 2025-09-09 22:43:22 +0900
Processing by Api::UsersController#update as HTML
  Parameters: {"user" => {"name" => "Updated Name"}, "id" => "36"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 36], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.6ms)[0m  [1m[33mUPDATE "users" SET "name" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["name", "Updated Name"], ["updated_at", "2025-09-09 13:43:22.654798"], ["id", 36]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (Views: 0.1ms | ActiveRecord: 6.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 36], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::UsersControllerTest: test_should_not_create_user_with_invalid_params
-------------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Leroy Durgan DVM"], ["phone", "010-1134-7685"], ["birth_date", "1998-12-03"], ["created_at", "2025-09-09 13:43:22.661143"], ["updated_at", "2025-09-09 13:43:22.661143"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Started POST "/api/users" for 127.0.0.1 at 2025-09-09 22:43:22 +0900
Processing by Api::UsersController#create as HTML
  Parameters: {"user" => {"name" => "", "email" => "[FILTERED]"}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 2ms (Views: 0.1ms | ActiveRecord: 1.3ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
Api::UsersControllerTest: test_should_create_user_with_valid_params
-------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Margarito Bernhard"], ["phone", "010-8580-5105"], ["birth_date", "1983-07-27"], ["created_at", "2025-09-09 13:43:22.670563"], ["updated_at", "2025-09-09 13:43:22.670563"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Started POST "/api/users" for 127.0.0.1 at 2025-09-09 22:43:22 +0900
Processing by Api::UsersController#create as HTML
  Parameters: {"user" => {"name" => "Test User", "email" => "[FILTERED]", "phone" => "010-1234-5678", "birth_date" => "1990-01-01"}}
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Test User"], ["phone", "010-1234-5678"], ["birth_date", "1990-01-01"], ["created_at", "2025-09-09 13:43:22.675013"], ["updated_at", "2025-09-09 13:43:22.675013"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.1ms | ActiveRecord: 3.0ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
Api::UsersControllerTest: test_should_destroy_user
--------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Marcelina Ratke"], ["phone", "010-4664-2765"], ["birth_date", "1976-04-25"], ["created_at", "2025-09-09 13:43:22.680713"], ["updated_at", "2025-09-09 13:43:22.680713"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Started DELETE "/api/users/40" for 127.0.0.1 at 2025-09-09 22:43:22 +0900
Processing by Api::UsersController#destroy as HTML
  Parameters: {"id" => "40"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 40], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Load (1.4ms)[0m  [1m[34mSELECT "memberships".* FROM "memberships" WHERE "memberships"."user_id" = $1[0m  [["user_id", 40]]
  [1m[36mConversation Load (0.7ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."user_id" = $1[0m  [["user_id", 40]]
  [1m[36mUser Destroy (0.8ms)[0m  [1m[31mDELETE FROM "users" WHERE "users"."id" = $1[0m  [["id", 40]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 11ms (ActiveRecord: 8.1ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
Api::UsersControllerTest: test_should_get_index
-----------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Eusebio Durgan"], ["phone", "010-6679-4396"], ["birth_date", "1997-05-01"], ["created_at", "2025-09-09 13:43:22.698216"], ["updated_at", "2025-09-09 13:43:22.698216"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/users" for 127.0.0.1 at 2025-09-09 22:43:22 +0900
Processing by Api::UsersController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.7ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (4.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
ChatControllerTest: test_should_handle_empty_message
----------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (2.2ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (1.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Teodoro Beer"], ["phone", "010-3735-5358"], ["birth_date", "1980-11-06"], ["created_at", "2025-09-09 13:43:57.964579"], ["updated_at", "2025-09-09 13:43:57.964579"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (2.0ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 42], ["title", "Id recusandae odit."], ["created_at", "2025-09-09 13:43:57.978372"], ["updated_at", "2025-09-09 13:43:57.978372"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/chat/message" for 127.0.0.1 at 2025-09-09 22:43:57 +0900
Processing by ChatController#message as HTML
  Parameters: {"conversation_id" => "20", "message" => "", "user_id" => "42"}
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (1.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 20], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
SSE Error: Validation failed: Content can't be blank
Completed 200 OK in 21ms (ActiveRecord: 7.9ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
ChatControllerTest: test_should_create_conversation
---------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (2.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Giovanna Cassin"], ["phone", "010-6375-1089"], ["birth_date", "1989-11-13"], ["created_at", "2025-09-09 13:43:58.052079"], ["updated_at", "2025-09-09 13:43:58.052079"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.0ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 43], ["title", "Explicabo ut fugit."], ["created_at", "2025-09-09 13:43:58.053794"], ["updated_at", "2025-09-09 13:43:58.053794"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "conversations"[0m
Started POST "/chat" for 127.0.0.1 at 2025-09-09 22:43:58 +0900
Processing by ChatController#create as HTML
  Parameters: {"title" => "New Chat", "user_id" => "43"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 43], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.1ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 43], ["title", "New Chat"], ["created_at", "2025-09-09 13:43:58.060811"], ["updated_at", "2025-09-09 13:43:58.060811"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.3ms | ActiveRecord: 2.6ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "conversations"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ChatControllerTest: test_should_send_message_to_conversation
------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.8ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Felix Douglas"], ["phone", "010-1007-1582"], ["birth_date", "1978-04-13"], ["created_at", "2025-09-09 13:43:58.068188"], ["updated_at", "2025-09-09 13:43:58.068188"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.3ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 44], ["title", "Porro et ut."], ["created_at", "2025-09-09 13:43:58.070068"], ["updated_at", "2025-09-09 13:43:58.070068"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (1.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "messages"[0m
Started POST "/chat/message" for 127.0.0.1 at 2025-09-09 22:43:58 +0900
Processing by ChatController#message as HTML
  Parameters: {"conversation_id" => "23", "message" => "Hello, AI!", "user_id" => "44"}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (1.2ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 23], ["LIMIT", 1]]
  [1m[36mMessage Create (2.1ms)[0m  [1m[32mINSERT INTO "messages" ("conversation_id", "role", "content", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["conversation_id", 23], ["role", "user"], ["content", "Hello, AI!"], ["created_at", "2025-09-09 13:43:58.076222"], ["updated_at", "2025-09-09 13:43:58.076222"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.6ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 23], ["LIMIT", 1]]
  [1m[36mMessage Create (0.4ms)[0m  [1m[32mINSERT INTO "messages" ("conversation_id", "role", "content", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["conversation_id", 23], ["role", "assistant"], ["content", "Test AI response"], ["created_at", "2025-09-09 13:43:58.080130"], ["updated_at", "2025-09-09 13:43:58.080130"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 7ms (ActiveRecord: 5.8ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "messages"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
ChatControllerTest: test_should_return_error_without_user
---------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Lisandra Rolfson"], ["phone", "010-7759-6396"], ["birth_date", "1994-08-22"], ["created_at", "2025-09-09 13:43:58.086062"], ["updated_at", "2025-09-09 13:43:58.086062"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.8ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 45], ["title", "Accusamus doloribus beatae."], ["created_at", "2025-09-09 13:43:58.087287"], ["updated_at", "2025-09-09 13:43:58.087287"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/chat" for 127.0.0.1 at 2025-09-09 22:43:58 +0900
Processing by ChatController#create as HTML
  Parameters: {"title" => "New Chat"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
Completed 422 Unprocessable Content in 2ms (Views: 0.1ms | ActiveRecord: 1.0ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
ChatControllerTest: test_should_handle_invalid_conversation_id
--------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Elliot Senger"], ["phone", "010-6918-4196"], ["birth_date", "1998-06-18"], ["created_at", "2025-09-09 13:43:58.094842"], ["updated_at", "2025-09-09 13:43:58.094842"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.6ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 46], ["title", "Ex omnis et."], ["created_at", "2025-09-09 13:43:58.096296"], ["updated_at", "2025-09-09 13:43:58.096296"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/chat/message" for 127.0.0.1 at 2025-09-09 22:43:58 +0900
Processing by ChatController#message as HTML
  Parameters: {"conversation_id" => "999999", "message" => "Test message", "user_id" => "46"}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.6ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 999999], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
SSE Error: Validation failed: Conversation must exist
Completed 200 OK in 2ms (ActiveRecord: 1.1ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
ChatControllerTest: test_should_stream_response_with_SSE_format
---------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Kraig Bernier PhD"], ["phone", "010-2392-1503"], ["birth_date", "1989-07-15"], ["created_at", "2025-09-09 13:43:58.103063"], ["updated_at", "2025-09-09 13:43:58.103063"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.9ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 47], ["title", "Ipsam ut cupiditate."], ["created_at", "2025-09-09 13:43:58.104530"], ["updated_at", "2025-09-09 13:43:58.104530"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/chat/message" for 127.0.0.1 at 2025-09-09 22:43:58 +0900
Processing by ChatController#message as HTML
  Parameters: {"conversation_id" => "26", "message" => "Test streaming", "user_id" => "47"}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (1.0ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 26], ["LIMIT", 1]]
  [1m[36mMessage Create (0.8ms)[0m  [1m[32mINSERT INTO "messages" ("conversation_id", "role", "content", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["conversation_id", 26], ["role", "user"], ["content", "Test streaming"], ["created_at", "2025-09-09 13:43:58.108334"], ["updated_at", "2025-09-09 13:43:58.108334"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 26], ["LIMIT", 1]]
  [1m[36mMessage Create (0.5ms)[0m  [1m[32mINSERT INTO "messages" ("conversation_id", "role", "content", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["conversation_id", 26], ["role", "assistant"], ["content", "Chunk 1Chunk 2"], ["created_at", "2025-09-09 13:43:58.111015"], ["updated_at", "2025-09-09 13:43:58.111015"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (ActiveRecord: 4.4ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (1.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
Api::UsersControllerTest: test_should_create_user_with_valid_params
-------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (1.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Teodoro Beer"], ["phone", "010-9518-7673"], ["birth_date", "2002-10-17"], ["created_at", "2025-09-09 13:43:58.117231"], ["updated_at", "2025-09-09 13:43:58.117231"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.7ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Started POST "/api/users" for 127.0.0.1 at 2025-09-09 22:43:58 +0900
Processing by Api::UsersController#create as HTML
  Parameters: {"user" => {"name" => "Test User", "email" => "[FILTERED]", "phone" => "010-1234-5678", "birth_date" => "1990-01-01"}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Test User"], ["phone", "010-1234-5678"], ["birth_date", "1990-01-01"], ["created_at", "2025-09-09 13:43:58.123735"], ["updated_at", "2025-09-09 13:43:58.123735"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 1.9ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
Api::UsersControllerTest: test_should_destroy_user
--------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Paris Ebert"], ["phone", "010-8916-3828"], ["birth_date", "1984-07-13"], ["created_at", "2025-09-09 13:43:58.129814"], ["updated_at", "2025-09-09 13:43:58.129814"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Started DELETE "/api/users/50" for 127.0.0.1 at 2025-09-09 22:43:58 +0900
Processing by Api::UsersController#destroy as HTML
  Parameters: {"id" => "50"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 50], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Load (1.3ms)[0m  [1m[34mSELECT "memberships".* FROM "memberships" WHERE "memberships"."user_id" = $1[0m  [["user_id", 50]]
  [1m[36mConversation Load (0.7ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."user_id" = $1[0m  [["user_id", 50]]
  [1m[36mUser Destroy (0.8ms)[0m  [1m[31mDELETE FROM "users" WHERE "users"."id" = $1[0m  [["id", 50]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 11ms (ActiveRecord: 7.7ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
Api::UsersControllerTest: test_should_return_404_for_non-existent_user
----------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Molly Larkin DC"], ["phone", "010-8522-9350"], ["birth_date", "2004-09-08"], ["created_at", "2025-09-09 13:43:58.148956"], ["updated_at", "2025-09-09 13:43:58.148956"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/users/999999" for 127.0.0.1 at 2025-09-09 22:43:58 +0900
Processing by Api::UsersController#show as HTML
  Parameters: {"id" => "999999"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 999999], ["LIMIT", 1]]
Filter chain halted as :set_user rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
Api::UsersControllerTest: test_should_update_user
-------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Keiko Hagenes DDS"], ["phone", "010-7780-3985"], ["birth_date", "1981-09-17"], ["created_at", "2025-09-09 13:43:58.155669"], ["updated_at", "2025-09-09 13:43:58.155669"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PATCH "/api/users/52" for 127.0.0.1 at 2025-09-09 22:43:58 +0900
Processing by Api::UsersController#update as HTML
  Parameters: {"user" => {"name" => "Updated Name"}, "id" => "52"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 52], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.4ms)[0m  [1m[33mUPDATE "users" SET "name" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["name", "Updated Name"], ["updated_at", "2025-09-09 13:43:58.162333"], ["id", 52]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 6ms (Views: 0.1ms | ActiveRecord: 5.2ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 52], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::UsersControllerTest: test_should_not_create_user_with_invalid_params
-------------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Rep. Numbers Brekke"], ["phone", "010-6540-8504"], ["birth_date", "1999-02-21"], ["created_at", "2025-09-09 13:43:58.168029"], ["updated_at", "2025-09-09 13:43:58.168029"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Started POST "/api/users" for 127.0.0.1 at 2025-09-09 22:43:58 +0900
Processing by Api::UsersController#create as HTML
  Parameters: {"user" => {"name" => "", "email" => "[FILTERED]"}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 2ms (Views: 0.1ms | ActiveRecord: 1.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
Api::UsersControllerTest: test_should_get_index
-----------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Prof. Weston Wunsch"], ["phone", "010-1819-5604"], ["birth_date", "1983-07-28"], ["created_at", "2025-09-09 13:43:58.177307"], ["updated_at", "2025-09-09 13:43:58.177307"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/users" for 127.0.0.1 at 2025-09-09 22:43:58 +0900
Processing by Api::UsersController#index as HTML
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.7ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
Api::UsersControllerTest: test_should_show_user
-----------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Theodore Bradtke"], ["phone", "010-4756-8771"], ["birth_date", "1997-11-26"], ["created_at", "2025-09-09 13:43:58.183162"], ["updated_at", "2025-09-09 13:43:58.183162"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/users/55" for 127.0.0.1 at 2025-09-09 22:43:58 +0900
Processing by Api::UsersController#show as HTML
  Parameters: {"id" => "55"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 55], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.4ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.5ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.9ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
Api::UsersControllerTest: test_should_update_user
-------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (2.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (1.0ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Rachal Grant"], ["phone", "010-1363-1621"], ["birth_date", "1985-02-24"], ["created_at", "2025-09-09 13:44:13.631493"], ["updated_at", "2025-09-09 13:44:13.631493"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PATCH "/api/users/56" for 127.0.0.1 at 2025-09-09 22:44:13 +0900
Processing by Api::UsersController#update as HTML
  Parameters: {"user" => {"name" => "Updated Name"}, "id" => "56"}
  [1m[36mUser Load (2.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 56], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.5ms)[0m  [1m[33mUPDATE "users" SET "name" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["name", "Updated Name"], ["updated_at", "2025-09-09 13:44:13.676334"], ["id", 56]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 14ms (Views: 0.2ms | ActiveRecord: 8.5ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 56], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
Api::UsersControllerTest: test_should_create_user_with_valid_params
-------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (2.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Ardis Stracke CPA"], ["phone", "010-2392-3589"], ["birth_date", "1995-06-01"], ["created_at", "2025-09-09 13:44:13.687755"], ["updated_at", "2025-09-09 13:44:13.687755"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Started POST "/api/users" for 127.0.0.1 at 2025-09-09 22:44:13 +0900
Processing by Api::UsersController#create as HTML
  Parameters: {"user" => {"name" => "Test User", "email" => "[FILTERED]", "phone" => "010-1234-5678", "birth_date" => "1990-01-01"}}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Test User"], ["phone", "010-1234-5678"], ["birth_date", "1990-01-01"], ["created_at", "2025-09-09 13:44:13.691535"], ["updated_at", "2025-09-09 13:44:13.691535"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 2ms (Views: 0.1ms | ActiveRecord: 1.7ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
Api::UsersControllerTest: test_should_show_user
-----------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Geoffrey Mertz PhD"], ["phone", "010-8422-1637"], ["birth_date", "1990-05-15"], ["created_at", "2025-09-09 13:44:13.696457"], ["updated_at", "2025-09-09 13:44:13.696457"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/users/59" for 127.0.0.1 at 2025-09-09 22:44:13 +0900
Processing by Api::UsersController#show as HTML
  Parameters: {"id" => "59"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 59], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
Api::UsersControllerTest: test_should_get_index
-----------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Dave Zieme JD"], ["phone", "010-9629-1375"], ["birth_date", "1977-10-05"], ["created_at", "2025-09-09 13:44:13.701395"], ["updated_at", "2025-09-09 13:44:13.701395"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/users" for 127.0.0.1 at 2025-09-09 22:44:13 +0900
Processing by Api::UsersController#index as HTML
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::UsersControllerTest: test_should_not_create_user_with_invalid_params
-------------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Ila Kihn"], ["phone", "010-2466-2438"], ["birth_date", "1981-08-02"], ["created_at", "2025-09-09 13:44:13.706512"], ["updated_at", "2025-09-09 13:44:13.706512"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Started POST "/api/users" for 127.0.0.1 at 2025-09-09 22:44:13 +0900
Processing by Api::UsersController#create as HTML
  Parameters: {"user" => {"name" => "", "email" => "[FILTERED]"}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 2ms (Views: 0.1ms | ActiveRecord: 1.2ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
Api::UsersControllerTest: test_should_destroy_user
--------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Jacinto Hilpert"], ["phone", "010-4623-2360"], ["birth_date", "1991-05-05"], ["created_at", "2025-09-09 13:44:13.714841"], ["updated_at", "2025-09-09 13:44:13.714841"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Started DELETE "/api/users/62" for 127.0.0.1 at 2025-09-09 22:44:13 +0900
Processing by Api::UsersController#destroy as HTML
  Parameters: {"id" => "62"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 62], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Load (1.2ms)[0m  [1m[34mSELECT "memberships".* FROM "memberships" WHERE "memberships"."user_id" = $1[0m  [["user_id", 62]]
  [1m[36mConversation Load (0.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."user_id" = $1[0m  [["user_id", 62]]
  [1m[36mUser Destroy (0.7ms)[0m  [1m[31mDELETE FROM "users" WHERE "users"."id" = $1[0m  [["id", 62]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 18ms (ActiveRecord: 11.5ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
Api::UsersControllerTest: test_should_return_404_for_non-existent_user
----------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Meredith Cummerata"], ["phone", "010-4567-7100"], ["birth_date", "1985-10-30"], ["created_at", "2025-09-09 13:44:13.739520"], ["updated_at", "2025-09-09 13:44:13.739520"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/users/999999" for 127.0.0.1 at 2025-09-09 22:44:13 +0900
Processing by Api::UsersController#show as HTML
  Parameters: {"id" => "999999"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 999999], ["LIMIT", 1]]
Filter chain halted as :set_user rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.7ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
ChatControllerTest: test_should_create_conversation
---------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Rickie Howell"], ["phone", "010-3145-1363"], ["birth_date", "1977-05-22"], ["created_at", "2025-09-09 13:44:13.745612"], ["updated_at", "2025-09-09 13:44:13.745612"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.0ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 64], ["title", "Odit occaecati quasi."], ["created_at", "2025-09-09 13:44:13.749690"], ["updated_at", "2025-09-09 13:44:13.749690"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "conversations"[0m
Started POST "/chat" for 127.0.0.1 at 2025-09-09 22:44:13 +0900
Processing by ChatController#create as HTML
  Parameters: {"title" => "New Chat", "user_id" => "64"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 64], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.8ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 64], ["title", "New Chat"], ["created_at", "2025-09-09 13:44:13.754505"], ["updated_at", "2025-09-09 13:44:13.754505"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 3ms (Views: 0.1ms | ActiveRecord: 1.9ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "conversations"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
ChatControllerTest: test_should_stream_response_with_SSE_format
---------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Ardis Stracke"], ["phone", "010-8826-8369"], ["birth_date", "1979-12-07"], ["created_at", "2025-09-09 13:44:13.761158"], ["updated_at", "2025-09-09 13:44:13.761158"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.7ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 65], ["title", "Placeat in blanditiis."], ["created_at", "2025-09-09 13:44:13.762827"], ["updated_at", "2025-09-09 13:44:13.762827"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/chat/message" for 127.0.0.1 at 2025-09-09 22:44:13 +0900
Processing by ChatController#message as HTML
  Parameters: {"conversation_id" => "29", "message" => "Test streaming", "user_id" => "65"}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (1.3ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 29], ["LIMIT", 1]]
  [1m[36mMessage Create (1.2ms)[0m  [1m[32mINSERT INTO "messages" ("conversation_id", "role", "content", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["conversation_id", 29], ["role", "user"], ["content", "Test streaming"], ["created_at", "2025-09-09 13:44:13.774504"], ["updated_at", "2025-09-09 13:44:13.774504"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.7ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 29], ["LIMIT", 1]]
  [1m[36mMessage Create (0.5ms)[0m  [1m[32mINSERT INTO "messages" ("conversation_id", "role", "content", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["conversation_id", 29], ["role", "assistant"], ["content", "Chunk 1Chunk 2"], ["created_at", "2025-09-09 13:44:13.777449"], ["updated_at", "2025-09-09 13:44:13.777449"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 13ms (ActiveRecord: 9.1ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
ChatControllerTest: test_should_handle_invalid_conversation_id
--------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Earlean Walter"], ["phone", "010-9047-6278"], ["birth_date", "2002-03-31"], ["created_at", "2025-09-09 13:44:13.781713"], ["updated_at", "2025-09-09 13:44:13.781713"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.7ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 66], ["title", "Dolores omnis et."], ["created_at", "2025-09-09 13:44:13.783231"], ["updated_at", "2025-09-09 13:44:13.783231"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/chat/message" for 127.0.0.1 at 2025-09-09 22:44:13 +0900
Processing by ChatController#message as HTML
  Parameters: {"conversation_id" => "999999", "message" => "Test message", "user_id" => "66"}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.6ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 999999], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
SSE Error: Validation failed: Conversation must exist
Completed 200 OK in 2ms (ActiveRecord: 1.1ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
ChatControllerTest: test_should_return_error_without_user
---------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Laurence Friesen"], ["phone", "010-9306-9629"], ["birth_date", "1976-09-18"], ["created_at", "2025-09-09 13:44:13.790618"], ["updated_at", "2025-09-09 13:44:13.790618"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.8ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 67], ["title", "Maiores et adipisci."], ["created_at", "2025-09-09 13:44:13.791961"], ["updated_at", "2025-09-09 13:44:13.791961"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/chat" for 127.0.0.1 at 2025-09-09 22:44:13 +0900
Processing by ChatController#create as HTML
  Parameters: {"title" => "New Chat"}
  [1m[36mUser Load (0.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
Completed 422 Unprocessable Content in 2ms (Views: 0.1ms | ActiveRecord: 0.5ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
ChatControllerTest: test_should_handle_empty_message
----------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Marge Cremin"], ["phone", "010-2466-2438"], ["birth_date", "1981-08-02"], ["created_at", "2025-09-09 13:44:13.798847"], ["updated_at", "2025-09-09 13:44:13.798847"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.7ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 68], ["title", "Rem reiciendis aliquid."], ["created_at", "2025-09-09 13:44:13.800038"], ["updated_at", "2025-09-09 13:44:13.800038"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/chat/message" for 127.0.0.1 at 2025-09-09 22:44:13 +0900
Processing by ChatController#message as HTML
  Parameters: {"conversation_id" => "32", "message" => "", "user_id" => "68"}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.7ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 32], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
SSE Error: Validation failed: Content can't be blank
Completed 200 OK in 2ms (ActiveRecord: 1.3ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ChatControllerTest: test_should_send_message_to_conversation
------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Kacey Keebler"], ["phone", "010-2360-6717"], ["birth_date", "1984-07-17"], ["created_at", "2025-09-09 13:44:13.807128"], ["updated_at", "2025-09-09 13:44:13.807128"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.7ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 69], ["title", "Officiis vitae rem."], ["created_at", "2025-09-09 13:44:13.808491"], ["updated_at", "2025-09-09 13:44:13.808491"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "messages"[0m
Started POST "/chat/message" for 127.0.0.1 at 2025-09-09 22:44:13 +0900
Processing by ChatController#message as HTML
  Parameters: {"conversation_id" => "33", "message" => "Hello, AI!", "user_id" => "69"}
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.6ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 33], ["LIMIT", 1]]
  [1m[36mMessage Create (0.4ms)[0m  [1m[32mINSERT INTO "messages" ("conversation_id", "role", "content", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["conversation_id", 33], ["role", "user"], ["content", "Hello, AI!"], ["created_at", "2025-09-09 13:44:13.812106"], ["updated_at", "2025-09-09 13:44:13.812106"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.6ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 33], ["LIMIT", 1]]
  [1m[36mMessage Create (0.4ms)[0m  [1m[32mINSERT INTO "messages" ("conversation_id", "role", "content", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["conversation_id", 33], ["role", "assistant"], ["content", "Test AI response"], ["created_at", "2025-09-09 13:44:13.814075"], ["updated_at", "2025-09-09 13:44:13.814075"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 4ms (ActiveRecord: 3.0ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "messages"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (2.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (1.7ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UserTest: test_should_not_save_user_without_name
------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mUser Exists? (1.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UserTest: test_should_have_many_conversations
---------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (1.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Miss Rodolfo Torp"], ["phone", "010-2398-8909"], ["birth_date", "2003-01-29"], ["created_at", "2025-09-09 13:49:23.023761"], ["updated_at", "2025-09-09 13:49:23.023761"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (2.7ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 70], ["title", "Quia ab dolorem."], ["created_at", "2025-09-09 13:49:23.036442"], ["updated_at", "2025-09-09 13:49:23.036442"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "conversations" WHERE "conversations"."user_id" = $1 AND "conversations"."id" = $2 LIMIT $3[0m  [["user_id", 70], ["id", 34], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
UserTest: test_should_destroy_associated_memberships_when_user_is_destroyed
---------------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.7ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Rev. Marni Thompson"], ["phone", "010-6935-7416"], ["birth_date", "1979-03-08"], ["created_at", "2025-09-09 13:49:23.051026"], ["updated_at", "2025-09-09 13:49:23.051026"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Create (3.0ms)[0m  [1m[32mINSERT INTO "memberships" ("user_id", "membership_type", "start_date", "end_date", "price", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 71], ["membership_type", "premium"], ["start_date", "2025-09-09"], ["end_date", "2025-10-09"], ["price", "99000.0"], ["status", "active"], ["created_at", "2025-09-09 13:49:23.063259"], ["updated_at", "2025-09-09 13:49:23.063259"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMembership Count (3.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "memberships"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Load (1.6ms)[0m  [1m[34mSELECT "memberships".* FROM "memberships" WHERE "memberships"."user_id" = $1[0m  [["user_id", 71]]
  [1m[36mMembership Destroy (0.7ms)[0m  [1m[31mDELETE FROM "memberships" WHERE "memberships"."id" = $1[0m  [["id", 1]]
  [1m[36mConversation Load (0.5ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."user_id" = $1[0m  [["user_id", 71]]
  [1m[36mUser Destroy (0.8ms)[0m  [1m[31mDELETE FROM "users" WHERE "users"."id" = $1[0m  [["id", 71]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMembership Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "memberships"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UserTest: test_should_not_allow_duplicate_emails
------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Kenny Monahan"], ["phone", "010-6479-1862"], ["birth_date", "1998-06-08"], ["created_at", "2025-09-09 13:49:23.080306"], ["updated_at", "2025-09-09 13:49:23.080306"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
UserTest: test_should_not_save_user_without_email
-------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------
UserTest: test_should_have_many_memberships
-------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Rayna Collier"], ["phone", "010-2572-2945"], ["birth_date", "1986-09-13"], ["created_at", "2025-09-09 13:49:23.087422"], ["updated_at", "2025-09-09 13:49:23.087422"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Create (0.8ms)[0m  [1m[32mINSERT INTO "memberships" ("user_id", "membership_type", "start_date", "end_date", "price", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 73], ["membership_type", "basic"], ["start_date", "2025-09-09"], ["end_date", "2025-10-09"], ["price", "49000.0"], ["status", "active"], ["created_at", "2025-09-09 13:49:23.088772"], ["updated_at", "2025-09-09 13:49:23.088772"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Create (0.7ms)[0m  [1m[32mINSERT INTO "memberships" ("user_id", "membership_type", "start_date", "end_date", "price", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 73], ["membership_type", "basic"], ["start_date", "2025-09-09"], ["end_date", "2025-10-09"], ["price", "49000.0"], ["status", "active"], ["created_at", "2025-09-09 13:49:23.090326"], ["updated_at", "2025-09-09 13:49:23.090326"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMembership Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "memberships" WHERE "memberships"."user_id" = $1[0m  [["user_id", 73]]
  [1m[36mMembership Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "memberships" WHERE "memberships"."user_id" = $1 AND "memberships"."id" = $2 LIMIT $3[0m  [["user_id", 73], ["id", 2], ["LIMIT", 1]]
  [1m[36mMembership Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "memberships" WHERE "memberships"."user_id" = $1 AND "memberships"."id" = $2 LIMIT $3[0m  [["user_id", 73], ["id", 3], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
MembershipTest: test_active_scope_should_return_active_memberships
------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Garret Schultz VM"], ["phone", "010-6842-3956"], ["birth_date", "1983-12-28"], ["created_at", "2025-09-09 13:49:23.096966"], ["updated_at", "2025-09-09 13:49:23.096966"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Create (0.8ms)[0m  [1m[32mINSERT INTO "memberships" ("user_id", "membership_type", "start_date", "end_date", "price", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 74], ["membership_type", "basic"], ["start_date", "2025-09-09"], ["end_date", "2025-10-09"], ["price", "49000.0"], ["status", "active"], ["created_at", "2025-09-09 13:49:23.098114"], ["updated_at", "2025-09-09 13:49:23.098114"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.3ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Josefina Strosin V"], ["phone", "010-3303-5861"], ["birth_date", "1994-02-01"], ["created_at", "2025-09-09 13:49:23.101019"], ["updated_at", "2025-09-09 13:49:23.101019"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Create (0.7ms)[0m  [1m[32mINSERT INTO "memberships" ("user_id", "membership_type", "start_date", "end_date", "price", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 75], ["membership_type", "basic"], ["start_date", "2025-07-11"], ["end_date", "2025-09-08"], ["price", "49000.0"], ["status", "expired"], ["created_at", "2025-09-09 13:49:23.102166"], ["updated_at", "2025-09-09 13:49:23.102166"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMembership Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "memberships" WHERE (end_date >= $1) AND "memberships"."id" = $2 LIMIT $3[0m  [[nil, "2025-09-09"], ["id", 4], ["LIMIT", 1]]
  [1m[36mMembership Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "memberships" WHERE (end_date >= $1) AND "memberships"."id" = $2 LIMIT $3[0m  [[nil, "2025-09-09"], ["id", 5], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
MembershipTest: test_should_belong_to_user
------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
MembershipTest: test_should_validate_membership_type_inclusion
--------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
MembershipTest: test_expired_scope_should_return_expired_memberships
--------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Catina Zulauf"], ["phone", "010-7135-3267"], ["birth_date", "1976-11-30"], ["created_at", "2025-09-09 13:49:23.111657"], ["updated_at", "2025-09-09 13:49:23.111657"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Create (0.7ms)[0m  [1m[32mINSERT INTO "memberships" ("user_id", "membership_type", "start_date", "end_date", "price", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 76], ["membership_type", "basic"], ["start_date", "2025-09-09"], ["end_date", "2025-10-09"], ["price", "49000.0"], ["status", "active"], ["created_at", "2025-09-09 13:49:23.112721"], ["updated_at", "2025-09-09 13:49:23.112721"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Francis Gerlach"], ["phone", "010-5293-3779"], ["birth_date", "2000-08-21"], ["created_at", "2025-09-09 13:49:23.116628"], ["updated_at", "2025-09-09 13:49:23.116628"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Create (0.9ms)[0m  [1m[32mINSERT INTO "memberships" ("user_id", "membership_type", "start_date", "end_date", "price", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 77], ["membership_type", "premium"], ["start_date", "2025-07-11"], ["end_date", "2025-09-08"], ["price", "99000.0"], ["status", "expired"], ["created_at", "2025-09-09 13:49:23.117785"], ["updated_at", "2025-09-09 13:49:23.117785"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMembership Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "memberships" WHERE (end_date < $1) AND "memberships"."id" = $2 LIMIT $3[0m  [[nil, "2025-09-09"], ["id", 7], ["LIMIT", 1]]
  [1m[36mMembership Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "memberships" WHERE (end_date < $1) AND "memberships"."id" = $2 LIMIT $3[0m  [[nil, "2025-09-09"], ["id", 6], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
MembershipTest: test_should_validate_end_date_is_after_start_date
-----------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
MembershipTest: test_should_accept_basic_membership_type
--------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
MembershipTest: test_should_accept_premium_membership_type
----------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
MembershipTest: test_premium_scope_should_return_only_premium_memberships
-------------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Jamel Hodkiewicz"], ["phone", "010-7780-6169"], ["birth_date", "2003-01-28"], ["created_at", "2025-09-09 13:49:23.130174"], ["updated_at", "2025-09-09 13:49:23.130174"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Create (0.7ms)[0m  [1m[32mINSERT INTO "memberships" ("user_id", "membership_type", "start_date", "end_date", "price", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 78], ["membership_type", "premium"], ["start_date", "2025-09-09"], ["end_date", "2025-11-08"], ["price", "99000.0"], ["status", "active"], ["created_at", "2025-09-09 13:49:23.131301"], ["updated_at", "2025-09-09 13:49:23.131301"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Richard Haag"], ["phone", "010-7802-3107"], ["birth_date", "2002-01-21"], ["created_at", "2025-09-09 13:49:23.133973"], ["updated_at", "2025-09-09 13:49:23.133973"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Create (0.6ms)[0m  [1m[32mINSERT INTO "memberships" ("user_id", "membership_type", "start_date", "end_date", "price", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 79], ["membership_type", "basic"], ["start_date", "2025-09-09"], ["end_date", "2025-10-09"], ["price", "49000.0"], ["status", "active"], ["created_at", "2025-09-09 13:49:23.135165"], ["updated_at", "2025-09-09 13:49:23.135165"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMembership Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "memberships" WHERE "memberships"."membership_type" = $1 AND "memberships"."id" = $2 LIMIT $3[0m  [["membership_type", "premium"], ["id", 8], ["LIMIT", 1]]
  [1m[36mMembership Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "memberships" WHERE "memberships"."membership_type" = $1 AND "memberships"."id" = $2 LIMIT $3[0m  [["membership_type", "premium"], ["id", 9], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (3.6ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (2.1ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------
ChatControllerTest: test_should_create_conversation
---------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (1.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (3.0ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (1.1ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Miss Rueben Reinger"], ["phone", "010-6144-2925"], ["birth_date", "1976-12-12"], ["created_at", "2025-09-09 13:50:41.549683"], ["updated_at", "2025-09-09 13:50:41.549683"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (2.2ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 80], ["title", "Necessitatibus et voluptatibus."], ["created_at", "2025-09-09 13:50:41.563707"], ["updated_at", "2025-09-09 13:50:41.563707"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Count (1.1ms)[0m  [1m[34mSELECT COUNT(*) FROM "conversations"[0m
Started POST "/chat" for 127.0.0.1 at 2025-09-09 22:50:41 +0900
Processing by ChatController#create as HTML
  Parameters: {"title" => "New Chat", "user_id" => "80"}
  [1m[36mUser Load (3.5ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 80], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.1ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 80], ["title", "New Chat"], ["created_at", "2025-09-09 13:50:41.630057"], ["updated_at", "2025-09-09 13:50:41.630057"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 18ms (Views: 0.2ms | ActiveRecord: 6.0ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mConversation Count (0.5ms)[0m  [1m[34mSELECT COUNT(*) FROM "conversations"[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------
ChatControllerTest: test_should_send_message_to_conversation
------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (2.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Shawn Powlowski"], ["phone", "010-8049-7374"], ["birth_date", "2004-03-23"], ["created_at", "2025-09-09 13:50:41.641175"], ["updated_at", "2025-09-09 13:50:41.641175"]]
  [1m[36mTRANSACTION (1.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.6ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 81], ["title", "Eos laudantium exercitationem."], ["created_at", "2025-09-09 13:50:41.646376"], ["updated_at", "2025-09-09 13:50:41.646376"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMessage Count (1.2ms)[0m  [1m[34mSELECT COUNT(*) FROM "messages"[0m
Started POST "/chat/message" for 127.0.0.1 at 2025-09-09 22:50:41 +0900
Processing by ChatController#message as HTML
  Parameters: {"conversation_id" => "37", "message" => "Hello, AI!", "user_id" => "81"}
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (1.5ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 37], ["LIMIT", 1]]
  [1m[36mMessage Create (0.9ms)[0m  [1m[32mINSERT INTO "messages" ("conversation_id", "role", "content", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["conversation_id", 37], ["role", "user"], ["content", "Hello, AI!"], ["created_at", "2025-09-09 13:50:41.662207"], ["updated_at", "2025-09-09 13:50:41.662207"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.7ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 37], ["LIMIT", 1]]
  [1m[36mMessage Create (0.5ms)[0m  [1m[32mINSERT INTO "messages" ("conversation_id", "role", "content", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["conversation_id", 37], ["role", "assistant"], ["content", "Test AI response"], ["created_at", "2025-09-09 13:50:41.665049"], ["updated_at", "2025-09-09 13:50:41.665049"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 13ms (ActiveRecord: 8.9ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mMessage Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "messages"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------
ChatControllerTest: test_should_return_error_without_user
---------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Lawerence Lindgren Esq."], ["phone", "010-5648-1472"], ["birth_date", "1978-08-22"], ["created_at", "2025-09-09 13:50:41.671281"], ["updated_at", "2025-09-09 13:50:41.671281"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.9ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 82], ["title", "Non laboriosam molestias."], ["created_at", "2025-09-09 13:50:41.672867"], ["updated_at", "2025-09-09 13:50:41.672867"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/chat" for 127.0.0.1 at 2025-09-09 22:50:41 +0900
Processing by ChatController#create as HTML
  Parameters: {"title" => "New Chat"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
Completed 422 Unprocessable Content in 3ms (Views: 0.1ms | ActiveRecord: 1.0ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
ChatControllerTest: test_should_handle_invalid_conversation_id
--------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Reynaldo Ebert V"], ["phone", "010-3857-2102"], ["birth_date", "1989-09-28"], ["created_at", "2025-09-09 13:50:41.681988"], ["updated_at", "2025-09-09 13:50:41.681988"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.0ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 83], ["title", "Debitis sed totam."], ["created_at", "2025-09-09 13:50:41.683488"], ["updated_at", "2025-09-09 13:50:41.683488"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/chat/message" for 127.0.0.1 at 2025-09-09 22:50:41 +0900
Processing by ChatController#message as HTML
  Parameters: {"conversation_id" => "999999", "message" => "Test message", "user_id" => "83"}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.9ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 999999], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
SSE Error: Validation failed: Conversation must exist
Completed 200 OK in 3ms (ActiveRecord: 1.8ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------
ChatControllerTest: test_should_stream_response_with_SSE_format
---------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (1.2ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Trena Medhurst"], ["phone", "010-1351-4271"], ["birth_date", "1983-08-30"], ["created_at", "2025-09-09 13:50:41.692752"], ["updated_at", "2025-09-09 13:50:41.692752"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.0ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 84], ["title", "Exercitationem sapiente praesentium."], ["created_at", "2025-09-09 13:50:41.694923"], ["updated_at", "2025-09-09 13:50:41.694923"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/chat/message" for 127.0.0.1 at 2025-09-09 22:50:41 +0900
Processing by ChatController#message as HTML
  Parameters: {"conversation_id" => "40", "message" => "Test streaming", "user_id" => "84"}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.8ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 40], ["LIMIT", 1]]
  [1m[36mMessage Create (0.6ms)[0m  [1m[32mINSERT INTO "messages" ("conversation_id", "role", "content", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["conversation_id", 40], ["role", "user"], ["content", "Test streaming"], ["created_at", "2025-09-09 13:50:41.698630"], ["updated_at", "2025-09-09 13:50:41.698630"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (0.9ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 40], ["LIMIT", 1]]
  [1m[36mMessage Create (0.6ms)[0m  [1m[32mINSERT INTO "messages" ("conversation_id", "role", "content", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5) RETURNING "id"[0m  [["conversation_id", 40], ["role", "assistant"], ["content", "Chunk 1Chunk 2"], ["created_at", "2025-09-09 13:50:41.701074"], ["updated_at", "2025-09-09 13:50:41.701074"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 5ms (ActiveRecord: 4.0ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
ChatControllerTest: test_should_handle_empty_message
----------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Tula Kris"], ["phone", "010-9234-4658"], ["birth_date", "1983-08-08"], ["created_at", "2025-09-09 13:50:41.707356"], ["updated_at", "2025-09-09 13:50:41.707356"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (1.1ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 85], ["title", "Repellat aliquid pariatur."], ["created_at", "2025-09-09 13:50:41.708902"], ["updated_at", "2025-09-09 13:50:41.708902"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started POST "/chat/message" for 127.0.0.1 at 2025-09-09 22:50:41 +0900
Processing by ChatController#message as HTML
  Parameters: {"conversation_id" => "41", "message" => "", "user_id" => "85"}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Load (1.0ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."id" = $1 LIMIT $2[0m  [["id", 41], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
SSE Error: Validation failed: Content can't be blank
Completed 200 OK in 3ms (ActiveRecord: 1.9ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------
Api::UsersControllerTest: test_should_create_user_with_valid_params
-------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Miss Rueben Reinger"], ["phone", "010-3351-6203"], ["birth_date", "2003-09-02"], ["created_at", "2025-09-09 13:50:41.719032"], ["updated_at", "2025-09-09 13:50:41.719032"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Started POST "/api/users" for 127.0.0.1 at 2025-09-09 22:50:41 +0900
Processing by Api::UsersController#create as HTML
  Parameters: {"user" => {"name" => "Test User", "email" => "[FILTERED]", "phone" => "010-1234-5678", "birth_date" => "1990-01-01"}}
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Test User"], ["phone", "010-1234-5678"], ["birth_date", "1990-01-01"], ["created_at", "2025-09-09 13:50:41.724281"], ["updated_at", "2025-09-09 13:50:41.724281"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 201 Created in 3ms (Views: 0.2ms | ActiveRecord: 1.9ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------------------
Api::UsersControllerTest: test_should_return_404_for_non-existent_user
----------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Audry Schaefer"], ["phone", "010-7187-5887"], ["birth_date", "2005-05-14"], ["created_at", "2025-09-09 13:50:41.730273"], ["updated_at", "2025-09-09 13:50:41.730273"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/users/999999" for 127.0.0.1 at 2025-09-09 22:50:41 +0900
Processing by Api::UsersController#show as HTML
  Parameters: {"id" => "999999"}
  [1m[36mUser Load (0.3ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 999999], ["LIMIT", 1]]
Filter chain halted as :set_user rendered or redirected
Completed 404 Not Found in 1ms (Views: 0.0ms | ActiveRecord: 0.3ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
Api::UsersControllerTest: test_should_not_create_user_with_invalid_params
-------------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Timothy Wyman Ret."], ["phone", "010-1855-6064"], ["birth_date", "1981-07-26"], ["created_at", "2025-09-09 13:50:41.735922"], ["updated_at", "2025-09-09 13:50:41.735922"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.6ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Started POST "/api/users" for 127.0.0.1 at 2025-09-09 22:50:41 +0900
Processing by Api::UsersController#create as HTML
  Parameters: {"user" => {"name" => "", "email" => "[FILTERED]"}}
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
Completed 422 Unprocessable Content in 2ms (Views: 0.1ms | ActiveRecord: 1.1ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
Api::UsersControllerTest: test_should_get_index
-----------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Steven Crist III"], ["phone", "010-6586-7811"], ["birth_date", "1975-11-18"], ["created_at", "2025-09-09 13:50:41.744879"], ["updated_at", "2025-09-09 13:50:41.744879"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/users" for 127.0.0.1 at 2025-09-09 22:50:41 +0900
Processing by Api::UsersController#index as HTML
  [1m[36mUser Load (0.6ms)[0m  [1m[34mSELECT "users".* FROM "users"[0m
Completed 200 OK in 1ms (Views: 0.3ms | ActiveRecord: 0.6ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------
Api::UsersControllerTest: test_should_show_user
-----------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Cletus Kihn"], ["phone", "010-5833-2023"], ["birth_date", "1978-08-16"], ["created_at", "2025-09-09 13:50:41.751665"], ["updated_at", "2025-09-09 13:50:41.751665"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started GET "/api/users/91" for 127.0.0.1 at 2025-09-09 22:50:41 +0900
Processing by Api::UsersController#show as HTML
  Parameters: {"id" => "91"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 91], ["LIMIT", 1]]
Completed 200 OK in 1ms (Views: 0.1ms | ActiveRecord: 0.9ms (1 query, 0 cached) | GC: 0.0ms)
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
Api::UsersControllerTest: test_should_destroy_user
--------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.9ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Jerald Grimes"], ["phone", "010-3421-6710"], ["birth_date", "1997-07-16"], ["created_at", "2025-09-09 13:50:41.760687"], ["updated_at", "2025-09-09 13:50:41.760687"]]
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Count (0.8ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
Started DELETE "/api/users/92" for 127.0.0.1 at 2025-09-09 22:50:41 +0900
Processing by Api::UsersController#destroy as HTML
  Parameters: {"id" => "92"}
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 92], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Load (1.4ms)[0m  [1m[34mSELECT "memberships".* FROM "memberships" WHERE "memberships"."user_id" = $1[0m  [["user_id", 92]]
  [1m[36mConversation Load (0.7ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."user_id" = $1[0m  [["user_id", 92]]
  [1m[36mUser Destroy (1.8ms)[0m  [1m[31mDELETE FROM "users" WHERE "users"."id" = $1[0m  [["id", 92]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 204 No Content in 14ms (ActiveRecord: 10.5ms (4 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "users"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
Api::UsersControllerTest: test_should_update_user
-------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Sen. Deedra Morissette"], ["phone", "010-4906-6409"], ["birth_date", "1976-03-05"], ["created_at", "2025-09-09 13:50:41.782585"], ["updated_at", "2025-09-09 13:50:41.782585"]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Started PATCH "/api/users/93" for 127.0.0.1 at 2025-09-09 22:50:41 +0900
Processing by Api::UsersController#update as HTML
  Parameters: {"user" => {"name" => "Updated Name"}, "id" => "93"}
  [1m[36mUser Load (3.2ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 93], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Update (0.4ms)[0m  [1m[33mUPDATE "users" SET "name" = $1, "updated_at" = $2 WHERE "users"."id" = $3[0m  [["name", "Updated Name"], ["updated_at", "2025-09-09 13:50:41.795571"], ["id", 93]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
Completed 200 OK in 12ms (Views: 0.1ms | ActiveRecord: 11.7ms (2 queries, 0 cached) | GC: 0.0ms)
  [1m[36mUser Load (0.4ms)[0m  [1m[34mSELECT "users".* FROM "users" WHERE "users"."id" = $1 LIMIT $2[0m  [["id", 93], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------------------------------------
UserTest: test_should_destroy_associated_memberships_when_user_is_destroyed
---------------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Miss Rueben Reinger"], ["phone", "010-6705-5742"], ["birth_date", "2000-04-07"], ["created_at", "2025-09-09 13:50:41.801516"], ["updated_at", "2025-09-09 13:50:41.801516"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Create (1.7ms)[0m  [1m[32mINSERT INTO "memberships" ("user_id", "membership_type", "start_date", "end_date", "price", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 94], ["membership_type", "basic"], ["start_date", "2025-09-09"], ["end_date", "2025-10-09"], ["price", "49000.0"], ["status", "active"], ["created_at", "2025-09-09 13:50:41.805603"], ["updated_at", "2025-09-09 13:50:41.805603"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMembership Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "memberships"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Load (0.8ms)[0m  [1m[34mSELECT "memberships".* FROM "memberships" WHERE "memberships"."user_id" = $1[0m  [["user_id", 94]]
  [1m[36mMembership Destroy (0.7ms)[0m  [1m[31mDELETE FROM "memberships" WHERE "memberships"."id" = $1[0m  [["id", 10]]
  [1m[36mConversation Load (0.5ms)[0m  [1m[34mSELECT "conversations".* FROM "conversations" WHERE "conversations"."user_id" = $1[0m  [["user_id", 94]]
  [1m[36mUser Destroy (0.6ms)[0m  [1m[31mDELETE FROM "users" WHERE "users"."id" = $1[0m  [["id", 94]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMembership Count (0.3ms)[0m  [1m[34mSELECT COUNT(*) FROM "memberships"[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------
UserTest: test_should_not_save_user_without_email
-------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" IS NULL LIMIT $1[0m  [["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UserTest: test_should_not_allow_duplicate_emails
------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Sherwood Torphy"], ["phone", "010-5721-3848"], ["birth_date", "1988-09-23"], ["created_at", "2025-09-09 13:50:41.819010"], ["updated_at", "2025-09-09 13:50:41.819010"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------
UserTest: test_should_have_many_memberships
-------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Robin O'Conner VM"], ["phone", "010-4263-8967"], ["birth_date", "1987-06-25"], ["created_at", "2025-09-09 13:50:41.824163"], ["updated_at", "2025-09-09 13:50:41.824163"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Create (0.8ms)[0m  [1m[32mINSERT INTO "memberships" ("user_id", "membership_type", "start_date", "end_date", "price", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 96], ["membership_type", "basic"], ["start_date", "2025-09-09"], ["end_date", "2025-10-09"], ["price", "49000.0"], ["status", "active"], ["created_at", "2025-09-09 13:50:41.825422"], ["updated_at", "2025-09-09 13:50:41.825422"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Create (1.3ms)[0m  [1m[32mINSERT INTO "memberships" ("user_id", "membership_type", "start_date", "end_date", "price", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 96], ["membership_type", "basic"], ["start_date", "2025-09-09"], ["end_date", "2025-10-09"], ["price", "49000.0"], ["status", "active"], ["created_at", "2025-09-09 13:50:41.827196"], ["updated_at", "2025-09-09 13:50:41.827196"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMembership Count (0.4ms)[0m  [1m[34mSELECT COUNT(*) FROM "memberships" WHERE "memberships"."user_id" = $1[0m  [["user_id", 96]]
  [1m[36mMembership Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "memberships" WHERE "memberships"."user_id" = $1 AND "memberships"."id" = $2 LIMIT $3[0m  [["user_id", 96], ["id", 11], ["LIMIT", 1]]
  [1m[36mMembership Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "memberships" WHERE "memberships"."user_id" = $1 AND "memberships"."id" = $2 LIMIT $3[0m  [["user_id", 96], ["id", 12], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------
UserTest: test_should_not_save_user_without_name
------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mUser Exists? (0.3ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
---------------------------------------------
UserTest: test_should_have_many_conversations
---------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Norbert Dietrich"], ["phone", "010-6733-3421"], ["birth_date", "1991-04-28"], ["created_at", "2025-09-09 13:50:41.836940"], ["updated_at", "2025-09-09 13:50:41.836940"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mConversation Create (0.7ms)[0m  [1m[32mINSERT INTO "conversations" ("user_id", "title", "created_at", "updated_at") VALUES ($1, $2, $3, $4) RETURNING "id"[0m  [["user_id", 97], ["title", "Sit voluptas labore."], ["created_at", "2025-09-09 13:50:41.838373"], ["updated_at", "2025-09-09 13:50:41.838373"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mConversation Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "conversations" WHERE "conversations"."user_id" = $1 AND "conversations"."id" = $2 LIMIT $3[0m  [["user_id", 97], ["id", 42], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
------------------------------------------------------------------
MembershipTest: test_active_scope_should_return_active_memberships
------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Miss Rueben Reinger"], ["phone", "010-8832-3784"], ["birth_date", "1995-06-05"], ["created_at", "2025-09-09 13:50:41.846472"], ["updated_at", "2025-09-09 13:50:41.846472"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Create (0.7ms)[0m  [1m[32mINSERT INTO "memberships" ("user_id", "membership_type", "start_date", "end_date", "price", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 98], ["membership_type", "basic"], ["start_date", "2025-09-09"], ["end_date", "2025-10-09"], ["price", "49000.0"], ["status", "active"], ["created_at", "2025-09-09 13:50:41.847615"], ["updated_at", "2025-09-09 13:50:41.847615"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "The Hon. Brook Buckridge"], ["phone", "010-5763-6705"], ["birth_date", "2001-12-10"], ["created_at", "2025-09-09 13:50:41.850241"], ["updated_at", "2025-09-09 13:50:41.850241"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Create (0.7ms)[0m  [1m[32mINSERT INTO "memberships" ("user_id", "membership_type", "start_date", "end_date", "price", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 99], ["membership_type", "basic"], ["start_date", "2025-07-11"], ["end_date", "2025-09-08"], ["price", "49000.0"], ["status", "expired"], ["created_at", "2025-09-09 13:50:41.851304"], ["updated_at", "2025-09-09 13:50:41.851304"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMembership Exists? (0.6ms)[0m  [1m[34mSELECT 1 AS one FROM "memberships" WHERE (end_date >= $1) AND "memberships"."id" = $2 LIMIT $3[0m  [[nil, "2025-09-09"], ["id", 13], ["LIMIT", 1]]
  [1m[36mMembership Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "memberships" WHERE (end_date >= $1) AND "memberships"."id" = $2 LIMIT $3[0m  [[nil, "2025-09-09"], ["id", 14], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
------------------------------------------
MembershipTest: test_should_belong_to_user
------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------------
MembershipTest: test_should_accept_premium_membership_type
----------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.6ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Cletus Kihn"], ["phone", "010-7096-1058"], ["birth_date", "1989-12-20"], ["created_at", "2025-09-09 13:50:41.859502"], ["updated_at", "2025-09-09 13:50:41.859502"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
MembershipTest: test_should_accept_basic_membership_type
--------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Yuri Mayert Esq."], ["phone", "010-6409-1178"], ["birth_date", "2001-01-26"], ["created_at", "2025-09-09 13:50:41.864124"], ["updated_at", "2025-09-09 13:50:41.864124"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------------------
MembershipTest: test_premium_scope_should_return_only_premium_memberships
-------------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Columbus McCullough"], ["phone", "010-9640-3477"], ["birth_date", "1985-07-10"], ["created_at", "2025-09-09 13:50:41.868463"], ["updated_at", "2025-09-09 13:50:41.868463"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Create (1.1ms)[0m  [1m[32mINSERT INTO "memberships" ("user_id", "membership_type", "start_date", "end_date", "price", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 102], ["membership_type", "premium"], ["start_date", "2025-09-09"], ["end_date", "2025-11-08"], ["price", "99000.0"], ["status", "active"], ["created_at", "2025-09-09 13:50:41.869688"], ["updated_at", "2025-09-09 13:50:41.869688"]]
  [1m[36mTRANSACTION (0.8ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Leda Walter"], ["phone", "010-4992-5954"], ["birth_date", "1980-05-08"], ["created_at", "2025-09-09 13:50:41.873813"], ["updated_at", "2025-09-09 13:50:41.873813"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Create (0.8ms)[0m  [1m[32mINSERT INTO "memberships" ("user_id", "membership_type", "start_date", "end_date", "price", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 103], ["membership_type", "basic"], ["start_date", "2025-09-09"], ["end_date", "2025-10-09"], ["price", "49000.0"], ["status", "active"], ["created_at", "2025-09-09 13:50:41.875123"], ["updated_at", "2025-09-09 13:50:41.875123"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMembership Exists? (0.4ms)[0m  [1m[34mSELECT 1 AS one FROM "memberships" WHERE "memberships"."membership_type" = $1 AND "memberships"."id" = $2 LIMIT $3[0m  [["membership_type", "premium"], ["id", 15], ["LIMIT", 1]]
  [1m[36mMembership Exists? (0.5ms)[0m  [1m[34mSELECT 1 AS one FROM "memberships" WHERE "memberships"."membership_type" = $1 AND "memberships"."id" = $2 LIMIT $3[0m  [["membership_type", "premium"], ["id", 16], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------
MembershipTest: test_should_validate_membership_type_inclusion
--------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------------------
MembershipTest: test_expired_scope_should_return_expired_memberships
--------------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (0.9ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.4ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Norberto Hintz"], ["phone", "010-5342-6168"], ["birth_date", "2002-05-02"], ["created_at", "2025-09-09 13:50:41.884383"], ["updated_at", "2025-09-09 13:50:41.884383"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Create (0.9ms)[0m  [1m[32mINSERT INTO "memberships" ("user_id", "membership_type", "start_date", "end_date", "price", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 104], ["membership_type", "premium"], ["start_date", "2025-09-09"], ["end_date", "2025-10-09"], ["price", "99000.0"], ["status", "active"], ["created_at", "2025-09-09 13:50:41.885677"], ["updated_at", "2025-09-09 13:50:41.885677"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mUser Exists? (1.0ms)[0m  [1m[34mSELECT 1 AS one FROM "users" WHERE "users"."email" = $1 LIMIT $2[0m  [["email", "[FILTERED]"], ["LIMIT", 1]]
  [1m[36mUser Create (0.5ms)[0m  [1m[32mINSERT INTO "users" ("email", "name", "phone", "birth_date", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6) RETURNING "id"[0m  [["email", "[FILTERED]"], ["name", "Rep. Chere Schuppe"], ["phone", "010-8313-8442"], ["birth_date", "1988-04-24"], ["created_at", "2025-09-09 13:50:41.889038"], ["updated_at", "2025-09-09 13:50:41.889038"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mMembership Create (0.8ms)[0m  [1m[32mINSERT INTO "memberships" ("user_id", "membership_type", "start_date", "end_date", "price", "status", "created_at", "updated_at") VALUES ($1, $2, $3, $4, $5, $6, $7, $8) RETURNING "id"[0m  [["user_id", 105], ["membership_type", "basic"], ["start_date", "2025-07-11"], ["end_date", "2025-09-08"], ["price", "49000.0"], ["status", "expired"], ["created_at", "2025-09-09 13:50:41.890368"], ["updated_at", "2025-09-09 13:50:41.890368"]]
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_1[0m
  [1m[36mMembership Exists? (0.7ms)[0m  [1m[34mSELECT 1 AS one FROM "memberships" WHERE (end_date < $1) AND "memberships"."id" = $2 LIMIT $3[0m  [[nil, "2025-09-09"], ["id", 18], ["LIMIT", 1]]
  [1m[36mMembership Exists? (0.8ms)[0m  [1m[34mSELECT 1 AS one FROM "memberships" WHERE (end_date < $1) AND "memberships"."id" = $2 LIMIT $3[0m  [[nil, "2025-09-09"], ["id", 17], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mBEGIN[0m
-----------------------------------------------------------------
MembershipTest: test_should_validate_end_date_is_after_start_date
-----------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mActiveRecord::InternalMetadata Load (4.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::SchemaMigration Load (4.4ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (1.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::SchemaMigration Load (0.3ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.4ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[35mSQL (0.3ms)[0m  [1m[35mSET search_path TO public[0m
  [1m[35m (93.4ms)[0m  [1m[35mDROP DATABASE IF EXISTS "ringle_task_test"[0m
  [1m[35m (88.3ms)[0m  [1m[35mCREATE DATABASE "ringle_task_test" ENCODING = 'unicode'[0m
  [1m[35mSQL (25.8ms)[0m  [1m[35mCREATE EXTENSION IF NOT EXISTS "plpgsql" SCHEMA pg_catalog[0m
  [1m[35m (0.3ms)[0m  [1m[35mDROP TABLE IF EXISTS "active_storage_attachments" CASCADE[0m
  [1m[35m (12.6ms)[0m  [1m[35mCREATE TABLE "active_storage_attachments" ("id" bigserial primary key, "name" character varying NOT NULL, "record_type" character varying NOT NULL, "record_id" bigint NOT NULL, "blob_id" bigint NOT NULL, "created_at" timestamp(6) NOT NULL)[0m
  [1m[35m (4.4ms)[0m  [1m[35mCREATE INDEX "index_active_storage_attachments_on_blob_id" ON "active_storage_attachments" ("blob_id")[0m
  [1m[35m (4.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_attachments_uniqueness" ON "active_storage_attachments" ("record_type", "record_id", "name", "blob_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "active_storage_blobs" CASCADE[0m
  [1m[35m (11.5ms)[0m  [1m[35mCREATE TABLE "active_storage_blobs" ("id" bigserial primary key, "key" character varying NOT NULL, "filename" character varying NOT NULL, "content_type" character varying, "metadata" text, "service_name" character varying NOT NULL, "byte_size" bigint NOT NULL, "checksum" character varying, "created_at" timestamp(6) NOT NULL)[0m
  [1m[35m (4.3ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_blobs_on_key" ON "active_storage_blobs" ("key")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "active_storage_variant_records" CASCADE[0m
  [1m[35m (12.4ms)[0m  [1m[35mCREATE TABLE "active_storage_variant_records" ("id" bigserial primary key, "blob_id" bigint NOT NULL, "variation_digest" character varying NOT NULL)[0m
  [1m[35m (3.7ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_active_storage_variant_records_uniqueness" ON "active_storage_variant_records" ("blob_id", "variation_digest")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "conversations" CASCADE[0m
  [1m[35m (9.3ms)[0m  [1m[35mCREATE TABLE "conversations" ("id" bigserial primary key, "user_id" bigint NOT NULL, "title" character varying NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE INDEX "index_conversations_on_created_at" ON "conversations" ("created_at")[0m
  [1m[35m (3.2ms)[0m  [1m[35mCREATE INDEX "index_conversations_on_user_id" ON "conversations" ("user_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "memberships" CASCADE[0m
  [1m[35m (7.4ms)[0m  [1m[35mCREATE TABLE "memberships" ("id" bigserial primary key, "user_id" bigint NOT NULL, "membership_type" character varying NOT NULL, "start_date" date NOT NULL, "end_date" date NOT NULL, "price" decimal(10,2), "status" character varying DEFAULT 'active', "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (3.3ms)[0m  [1m[35mCREATE INDEX "index_memberships_on_end_date" ON "memberships" ("end_date")[0m
  [1m[35m (3.5ms)[0m  [1m[35mCREATE INDEX "index_memberships_on_membership_type" ON "memberships" ("membership_type")[0m
  [1m[35m (2.6ms)[0m  [1m[35mCREATE INDEX "index_memberships_on_start_date" ON "memberships" ("start_date")[0m
  [1m[35m (2.5ms)[0m  [1m[35mCREATE INDEX "index_memberships_on_status" ON "memberships" ("status")[0m
  [1m[35m (5.5ms)[0m  [1m[35mCREATE INDEX "index_memberships_on_user_id" ON "memberships" ("user_id")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "messages" CASCADE[0m
  [1m[35m (7.5ms)[0m  [1m[35mCREATE TABLE "messages" ("id" bigserial primary key, "conversation_id" bigint NOT NULL, "role" character varying NOT NULL, "content" text NOT NULL, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL, "has_user_audio" boolean DEFAULT FALSE, "audio_duration" float, "audio_format" character varying)[0m
  [1m[35m (11.6ms)[0m  [1m[35mCREATE INDEX "index_messages_on_conversation_id_and_created_at" ON "messages" ("conversation_id", "created_at")[0m
  [1m[35m (7.2ms)[0m  [1m[35mCREATE INDEX "index_messages_on_conversation_id" ON "messages" ("conversation_id")[0m
  [1m[35m (5.5ms)[0m  [1m[35mCREATE INDEX "index_messages_on_has_user_audio" ON "messages" ("has_user_audio")[0m
  [1m[35m (0.2ms)[0m  [1m[35mDROP TABLE IF EXISTS "users" CASCADE[0m
  [1m[35m (6.9ms)[0m  [1m[35mCREATE TABLE "users" ("id" bigserial primary key, "email" character varying NOT NULL, "name" character varying NOT NULL, "phone" character varying, "birth_date" date, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[35m (6.0ms)[0m  [1m[35mCREATE UNIQUE INDEX "index_users_on_email" ON "users" ("email")[0m
  [1m[35m (2.7ms)[0m  [1m[35mALTER TABLE "active_storage_attachments" ADD CONSTRAINT "fk_rails_c3b3935057"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
[0m
  [1m[35m (4.3ms)[0m  [1m[35mALTER TABLE "active_storage_variant_records" ADD CONSTRAINT "fk_rails_993965df05"
FOREIGN KEY ("blob_id")
  REFERENCES "active_storage_blobs" ("id")
[0m
  [1m[35m (1.9ms)[0m  [1m[35mALTER TABLE "conversations" ADD CONSTRAINT "fk_rails_7c15d62a0a"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
[0m
  [1m[35m (2.1ms)[0m  [1m[35mALTER TABLE "memberships" ADD CONSTRAINT "fk_rails_99326fb65d"
FOREIGN KEY ("user_id")
  REFERENCES "users" ("id")
[0m
  [1m[35m (2.0ms)[0m  [1m[35mALTER TABLE "messages" ADD CONSTRAINT "fk_rails_7f927086d2"
FOREIGN KEY ("conversation_id")
  REFERENCES "conversations" ("id")
[0m
  [1m[35m (7.3ms)[0m  [1m[35mCREATE TABLE "schema_migrations" ("version" character varying NOT NULL PRIMARY KEY)[0m
  [1m[36mActiveRecord::SchemaMigration Load (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (1.3ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES (7)[0m
  [1m[35m (1.2ms)[0m  [1m[32mINSERT INTO "schema_migrations" (version) VALUES
(6),
(5),
(4),
(3),
(2),
(1);[0m
  [1m[35m (7.2ms)[0m  [1m[35mCREATE TABLE "ar_internal_metadata" ("key" character varying NOT NULL PRIMARY KEY, "value" character varying, "created_at" timestamp(6) NOT NULL, "updated_at" timestamp(6) NOT NULL)[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.8ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.3ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('environment', 'test', '2025-09-10 11:36:42.901066', '2025-09-10 11:36:42.901070') RETURNING "key"[0m
  [1m[36mActiveRecord::InternalMetadata Load (0.3ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "environment"]]
  [1m[36mActiveRecord::InternalMetadata Load (0.2ms)[0m  [1m[34mSELECT * FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = $1 ORDER BY "ar_internal_metadata"."key" ASC LIMIT 1[0m  [[nil, "schema_sha1"]]
  [1m[36mActiveRecord::InternalMetadata Create (1.2ms)[0m  [1m[32mINSERT INTO "ar_internal_metadata" ("key", "value", "created_at", "updated_at") VALUES ('schema_sha1', '7fca0e1db48b0d130d6e219b355f88ab9eea786c', '2025-09-10 11:36:42.904525', '2025-09-10 11:36:42.904527') RETURNING "key"[0m
  [1m[36mActiveRecord::SchemaMigration Load (1.2ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------
MessageCacheServiceTest: test_should_cache_message
--------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
-------------------------------------------------------------
MessageCacheServiceTest: test_should_clear_conversation_cache
-------------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
--------------------------------------------------------
MessageCacheServiceTest: test_should_get_cached_messages
--------------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mBEGIN[0m
----------------------------------------------------
MessageCacheServiceTest: test_should_get_cache_stats
----------------------------------------------------
[dotenv] Saved a snapshot of [32mENV[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK[0m
